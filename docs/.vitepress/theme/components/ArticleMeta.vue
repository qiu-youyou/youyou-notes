<script lang="ts" setup>
import { computed, ref, onMounted } from "vue";
import { wordcalc } from "../utils/wordcalc";

const wordCount = ref(0);
const imageCount = ref(0);

const wordTime = computed(() => {
  return (wordCount.value / 275) * 60;
});

const imageTime = computed(() => {
  const n = imageCount.value;
  if (imageCount.value <= 10) {
    // 等差数列求和
    return n * 13 + (n * (n - 1)) / 2;
  }
  return 175 + (n - 10) * 3;
});

// 阅读时间
const readTime = computed(() => {
  return Math.ceil((wordTime.value + imageTime.value) / 60);
});

function analyze() {
  document.querySelectorAll(".meta-des").forEach((v) => v.remove());
  const docDomContainer = window.document.querySelector("#VPContent");
  const imgs = docDomContainer?.querySelectorAll<HTMLImageElement>(
    ".content-container .main img"
  );
  imageCount.value = imgs?.length || 0;
  const words =
    docDomContainer?.querySelector(".content-container .main")?.textContent ||
    "";
  wordCount.value = wordcalc(words);
}

onMounted(() => {
  analyze();
});
</script>

<template>
  <div class="word">
    <p style="margin: 20px 0 0px 0">
      <svg
        t="1731324884448"
        class="icon"
        viewBox="0 0 1024 1024"
        version="1.1"
        xmlns="http://www.w3.org/2000/svg"
        p-id="13029"
        width="20"
        height="20"
        style="transform: translate(0px, 4px)"
      >
        <path
          d="M754.136615 88.812308c39.542154 0 69.474462 12.248615 89.875693 36.78523 20.361846 24.536615 30.562462 54.508308 30.562461 89.796924v521.255384c0 16.384-6.498462 31.113846-19.456 44.189539l-154.702769 157.065846c-8.034462 7.207385-14.808615 11.776-20.361846 13.745231a64.984615 64.984615 0 0 1-21.307077 2.953846H242.806154A105.550769 105.550769 0 0 1 200.192 945.230769a119.099077 119.099077 0 0 1-37.966769-26.505846 139.815385 139.815385 0 0 1-27.332923-41.235692c-7.089231-16.029538-10.633846-33.870769-10.633846-53.484308V215.433846c0-38.596923 10.003692-69.356308 30.089846-92.278154 20.086154-22.882462 48.600615-34.343385 85.661538-34.343384h514.126769z m-194.56 615.463384a26.939077 26.939077 0 0 0 20.401231-8.822154 30.326154 30.326154 0 0 0 8.349539-21.622153c0-9.137231-2.756923-16.541538-8.349539-22.055385a27.726769 27.726769 0 0 0-20.361846-8.349538H269.666462a27.726769 27.726769 0 0 0-20.401231 8.349538 29.853538 29.853538 0 0 0-8.310154 22.055385c0 8.507077 2.756923 15.753846 8.310154 21.622153 5.592615 5.907692 12.366769 8.822154 20.401231 8.822154h289.949538z m115.830154-184.556307a26.939077 26.939077 0 0 0 20.361846-8.822154 30.326154 30.326154 0 0 0 8.349539-21.582769 30.326154 30.326154 0 0 0-8.349539-21.622154 26.939077 26.939077 0 0 0-20.361846-8.822154H269.666462a26.939077 26.939077 0 0 0-20.401231 8.822154 30.326154 30.326154 0 0 0-8.310154 21.622154c0 8.507077 2.756923 15.675077 8.310154 21.582769 5.592615 5.907692 12.366769 8.822154 20.401231 8.822154h405.740307z m57.422769-183.532308a26.939077 26.939077 0 0 0 20.401231-8.861539 31.586462 31.586462 0 0 0 8.310154-22.567384 30.326154 30.326154 0 0 0-8.310154-21.582769 26.939077 26.939077 0 0 0-20.401231-8.861539H269.666462a26.939077 26.939077 0 0 0-20.401231 8.861539 30.326154 30.326154 0 0 0-8.310154 21.582769c0 9.176615 2.756923 16.699077 8.310154 22.567384 5.592615 5.907692 12.366769 8.861538 20.401231 8.861539h463.163076z"
          fill="#25a3ee"
          p-id="13030"
        ></path>
      </svg>
      当前字数: {{ wordCount }} 字
      <span style="margin: 0 10px"></span>
      <svg
        t="1731325000719"
        class="icon"
        viewBox="0 0 1024 1024"
        version="1.1"
        xmlns="http://www.w3.org/2000/svg"
        p-id="18030"
        width="17"
        height="17"
        style="transform: translate(-2px, 3px)"
      >
        <path
          d="M512 0A511.998537 511.998537 0 1 1 0.294033 529.552773L0.001463 511.998537A511.998537 511.998537 0 0 1 494.445764 0.292571L512 0z m-50.980426 153.818989A51.199854 51.199854 0 0 0 409.600293 204.799415v409.59883a51.199854 51.199854 0 0 0 51.199853 51.199853h307.199123a51.199854 51.199854 0 0 0 0-102.399707H512V204.799415a51.199854 51.199854 0 0 0-50.980426-50.980426z"
          fill="#25a3ee"
          p-id="18031"
        ></path>
      </svg>

      阅读时长: {{ readTime }} 分钟
    </p>
  </div>
</template>

<style scoped>
.word {
  color: var(--vp-c-text-2);
  font-size: 15px;
}

.icon {
  display: inline-block;
}
</style>
