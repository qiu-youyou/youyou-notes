# JavaScript 设计模式-面向对象

## 概念

### 类

> 类（Class）：对象的模板

> 类就像是一个模板，它定义了对象的属性和方法。通过类可以创建多个具有相同属性和方法的对象。

让我们用 `Person` 类作为例子来进一步解释面向对象编程中的“类”概念：

比如你正在开发一个管理系统，需要处理人员信息:

- 这些人员都有名字、年龄（属性）。

- 这些人员有一些共同的行为，比如 吃饭、讲话（方法）。

- 这时定义一个 `Person` 类，它就像是一个“具有共同特征和行为的人员模具”。

::: code-group

<<< ./assets/oop.js#class

:::

### 对象

> 对象（Object）：类的实例

> 对象是类的实例（类是对象的模板-在这里具象了哦）。它是包含数据和功能的集合。可以通过类来实例化很多个对象。

现在继续，用 `Person` 类，创建不同的人员对象，并调用它们的方法来模拟这些行为：

::: code-group

<<< ./assets/oop.js#object

:::

::: tip 在上面例子中:

- `Person` 类定义了两个方法 `(eat、speak)`，分别用于模拟人吃饭、讲话的行为。
- 当使用 `new` 关键字和 `Person` 类创建一个新对象时，这个对象就可以使用这些方法。
- 然后，我们可以通过调用这些方法来实现特定的行为。

这种方式的好处是，我们只需要编写一份 `Person` 类的代码，就可以轻松地创建和管理大量的人员对象，并且每个对象都可以独立地执行这些行为。它允许我们定义通用的模板，并根据需要创建具有独特特征和行为的对象。
:::

## 三要素

### 继承

> 继承（Inheritance），子类继承父类。

> 继承是面向对象编程中一种基本的代码复用机制。它允许一个类（称为子类或派生类）继承另一个类（称为父类或基类）的属性和方法。这样，子类就可以重用父类中已经定义好的代码，同时还可以添加或覆盖一些特定的功能。

父类：我们继续使用 `Person` 类作为 基类（父类）：

- 这里作为 “具有共同特征和行为的人员模具” 的 `Person` 类，包含了：
- 属性：`name`、`age`
- 方法：`eat`，`speak`

::: code-group
<<< ./assets/oop.js#class
:::

子类继承父类: 创建 `Student` 类作为派生类（子类），继承自 `Person`：

- 这里除了继承 `Person` 父类的属性和方法, 我们要添加：
- `Student` 子类 特有的属性，比如: 学号 `studentId` 。
- `Student` 子类 特有的行为（方法），比如：学习 `study`。

::: code-group
<<< ./assets/oop.js#student
:::

::: tip 在这个例子中:

- `Student` 类通过`extends` 关键字继承了 `Person` 类。

- `Person` 是父类，是公共的，它不仅仅服务于 `Student`

- `Student` 类的构造函数中，我们使用 `super(name, age)` 来调用父类的构造函数，以确保从父类继承的属性 `(name、age)` 被正确初始化。

- 然后，我们添加了子类特有的属性 `studentId`。还添加了一个新的方法 `study`，这是父类中没有的。

通过使用继承，我们可以轻松地创建具有共享属性和方法的类，同时还可以在子类中添加特定的功能。在这里 `People` 不仅仅服务于 `Student`。继承可已将公共方法抽离出来，提高复用，减少冗余。
:::

### 封装

> 封装（Encapsulation），数据的权限和保密。

> 封装是面向对象编程中一种保护数据的方式。它将类的属性和方法结合在一起，形成一个独立的单元，并对外部隐藏类的内部实现细节，只暴露必要的接口给外部使用。这样，类的内部状态只能通过类提供的方法进行访问和修改，从而保证了数据的安全性和完整性。

::: tip 三个关键字 ！！!：

封装呢，首先要提到这三个关键字：

- public: 完全开放、private: 对自己开放、 protected: 对子类开放(自己也可以访问)

纯面向对象语言就是通过这个三个关键字来做封装。

但是 JS 中并没有这个三个关键字，体现不出封装的特性！

ES2019 引入的私有字段语法（#前缀），这是 JavaScript 中实现私有属性的官方方式。在之前的 JavaScript 版本中，通常使用约定（如下划线前缀\_）或闭包来模拟私有属性。不是简单和固用的方式来做封装。

有关可以阅读 [MDN-类-私有属性](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Classes/Private_properties)

下面使用 `TypeScript` 实现! 下面使用 `TypeScript` 实现! 下面使用 `TypeScript` 实现!

:::

这里我们继续使用 `Person` 类作为 基类（父类），用 `TS` 来改造一下:

- 给 `Person` 类增加一个 `protected` 属性 `personId`。
- 它可以在 `Person` 类及其子类（如 `Student`）中被访问和修改。

::: code-group

<<< ./assets/oop.ts#person

:::

定义派生类（子类）`Student`，继承自 `Person`:

- 把 `Student` 子类特有的属性，`studentId` 改为私有属性 `private`。
- `studentId` 只能在 `Student` 类内部被访问和修改。

::: code-group

<<< ./assets/oop.ts#student

:::

::: code-group

<<< ./assets/oop.ts#example

:::

::: tip 在这个例子中：

- `Person` 类有一个 `protected` 属性 `personId`，它在 `Person` 类及子类 `Student` 中被访问和修改。
- 而 `Student` 类有一个 `private` 属性 `studentId`，它只能在 `Student` 类内部被访问和修改。
- 隐藏对象的内部状态和行为，仅通过公共方法暴露必要的接口。减少耦合，不该外漏的不外漏。

:::

### 多态

> 多态（Polymorphism），同一接口不同表现。

> 多态是面向对象编程中一种实现接口重用的机制。它允许一个接口在不同的实例中以不同的方式实现。多态通常通过继承和方法重写来实现。在运行时，系统可以根据对象的实际类型来决定调用哪个方法，从而实现动态绑定。

::: tip

多态需要结合 `Java` 等语言的接口、重写、重载等功能。这些 `JS` 中都没有。

面向接口编程中，有时不关心子类中是怎么实现的，只需要关心父类有多少接口，是什么样的接口。但这些在 `JS` 中体现并不明显。

`JS` 多态的体现并不像在一些静态类型语言（如 `Java`或 `C++`）中那样显式或强制，但多态的概念和效果在 `JS` 中仍然是存在的，并且非常重要。

由于 `JS` 的灵活性，有时候开发者可能会不自觉地绕过多态性（例如，通过直接检查对象的类型或属性来决定行为）。

:::

实现一个多态的列子：

- 有一个基类 `Animal`，以及两个继承自 `Animal` 的子类 `Dog` 和 `Cat`。
- 每个类都有一个 `Speak` 方法，但它们的实现是不同的。

::: code-group

<<< ./assets/polymorphism.js#polymorphism

:::

创建实例并展示多态行为:

::: code-group

<<< ./assets/polymorphism.js#example

:::

::: tip 在这个例子中

- 我们使用了 `class` 和 `extends` 关键字来定义类和继承关系。每个子类都重写了 `speak` 方法，以提供自己的实现。

- `makeAnimalSpeak` 函数接受一个 `Animal` 类型的参数（实际上是 `Animal` 的实例或其子类的实例），并调用其 `speak` 方法。

- 由于 `JavaScript` 的动态类型特性，它会在运行时根据对象的实际类型调用正确的方法，这就是多态的体现。

- 以后如果添加更多的动物类型，只需定义新的子类并重写 `speak` 方法即可，无需修改现有的 `makeAnimalSpeak` 函数或其他相关代码。

:::

## 应用

使用 `ES6` 的 `class` 语法来模拟 `jQuery` 的一个小片段:

- 定义一个基础类，用于封装 `DOM` 操作:

::: code-group

<<< ./assets/demo-jquery.js#DOMManipulator

:::

::: warning 请注意
虽然 JavaScript 没有正式的私有方法或属性（直到 ES2019 的私有类字段提案），但我们可以通过约定（如下划线前缀）和闭包来模拟私有成员。在上面的例子中，`_applyToElements` 方法被视为私有方法，因为它不应该被类的外部直接调用。
:::

- 定义一个继承自 `DOMManipulator` 的类，用于更具体的操作:

::: code-group

<<< ./assets/demo-jquery.js#DemoJQuery

:::

- 最后挂载一个 `$` 到 `window`:

::: code-group

<<< ./assets/demo-jquery.js#window

:::

- 使用 `demo` 示例：

::: code-group

<<< ./assets/demo-jquery.html
<<< ./assets/demo-jquery.js

:::

::: tip 在这个例子中：

封装：

- `DOMManipulator` 类封装了 `DOM` 操作的基本逻辑，而 `DemoJQuery` 类则进一步封装了特定的功能。
- `_applyToElements` 方法是一个私有方法（通过约定使用下划线前缀来表示），它封装了遍历元素并应用操作的逻辑。

继承：

- `DemoJQuery` 类继承 `DOMManipulator` 类，从而能够重用其 `DOM` 操作的基本逻辑。
- 同时，`DemoJQuery` 类还可以添加或重写方法以提供额外的功能。

多态：

- 在这个例子中，多态性可能不那么明显，因为我们没有创建多个子类来展示不同的行为。
- 然而，`DemoJQuery` 类本身可以视为一个多态的实体，它提供了与 `DOMManipulator` 类相似的接口（方法集），但具有额外的功能（如事件绑定和日志记录）。

体现面向对象思想的关键在于封装、继承和多态这三个基本原则。

:::

## 总结

我们所有的教程文档都在说面向对象可以表达万物，比如上面我们演示的 `Person` 、`Animal` 、`xiaoMing`、`xiaoHong` 这些，都是和我们日常生活对应的。这只是为了让我们好学习而已。面向对象的意义，根本不在于此。(所以不要纠结那些 吃、睡、猫叫、狗叫！！！)

我们日常使用的编程语言，所有程序的执行都是通过: 顺序、判断、循环 这三种方式来搞定。我们限定了一种规范，这三种可以满足所有的需求。对程序来说这就叫结构化了。

面向对象的意义是将零散的数据进行结构化。结构化的东西才是最简单的。编程也应该是简单和抽象的。

所以面向对象就是：数据结构化。

> [《松本行弘的程序世界》](https://book.douban.com/subject/6756090/)
